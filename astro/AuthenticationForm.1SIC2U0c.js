import{j as e}from"./jsx-runtime.hJzLw87X.js";import{r as i}from"./index.TBYTbSNu.js";import{a as C,G}from"./GoogleIcon.5JPDiU4T.js";import{s as y}from"./jwt.29ZsqLlk.js";import{b as I,h as A}from"./http.kuYOMQBZ.js";import{S as E}from"./Spinner.OJ_JJIYt.js";const j="githubRedirectAt",v="githubLastPage";function U(u){const{isDisabled:g,setIsDisabled:t}=u,[n,a]=i.useState(!1),[m,c]=i.useState("");i.useEffect(()=>{const o=new URLSearchParams(window.location.search),l=o.get("code"),d=o.get("state"),p=o.get("provider");!l||!d||p!=="github"||(a(!0),t?.(!0),I(`https://api.roadmap.sh/v1-github-callback${window.location.search}`).then(({response:r,error:w})=>{if(!r?.token){const S=w?.message||"Something went wrong.";c(S),a(!1),t?.(!1);return}let s="/";const x=localStorage.getItem(j),h=localStorage.getItem(v);if(x&&h){const S=parseInt(x,10);Date.now()-S<30*1e3&&(s=h)}const b=localStorage.getItem("authRedirect");b&&(localStorage.removeItem("authRedirect"),s=b),localStorage.removeItem(j),localStorage.removeItem(v),y(r.token),window.location.href=s}).catch(r=>{c("Something went wrong. Please try again later."),a(!1),t?.(!1)}))},[]);const f=async()=>{a(!0),t?.(!0);const{response:o,error:l}=await I("https://api.roadmap.sh/v1-github-login");if(l||!o?.loginUrl){c(l?.message||"Something went wrong. Please try again later."),a(!1),t?.(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const d=["/respond-invite","/befriend","/r","/ai"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(j,Date.now().toString()),localStorage.setItem(v,d)}window.location.href=o.loginUrl};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:n||g,onClick:f,children:[n?e.jsx(E,{className:"h-[18px] w-[18px]",isDualRing:!1}):e.jsx(C,{className:"h-[18px] w-[18px]"}),"Continue with GitHub"]}),m&&e.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:m})]})}const k="googleRedirectAt",N="googleLastPage";function F(u){const{isDisabled:g,setIsDisabled:t}=u,[n,a]=i.useState(!1),[m,c]=i.useState("");i.useEffect(()=>{const o=new URLSearchParams(window.location.search),l=o.get("code"),d=o.get("state"),p=o.get("provider");!l||!d||p!=="google"||(a(!0),t?.(!0),I(`https://api.roadmap.sh/v1-google-callback${window.location.search}`).then(({response:r,error:w})=>{if(!r?.token){c(w?.message||"Something went wrong."),a(!1),t?.(!1);return}let s="/";const x=localStorage.getItem(k),h=localStorage.getItem(N);if(x&&h){const S=parseInt(x,10);Date.now()-S<30*1e3&&(s=h)}const b=localStorage.getItem("authRedirect");b&&(localStorage.removeItem("authRedirect"),s=b),localStorage.removeItem(k),localStorage.removeItem(N),y(r.token),window.location.href=s}).catch(r=>{c("Something went wrong. Please try again later."),a(!1),t?.(!1)}))},[]);const f=()=>{a(!0),t?.(!0),I("https://api.roadmap.sh/v1-google-login").then(({response:o,error:l})=>{if(!o?.loginUrl){c(l?.message||"Something went wrong."),a(!1),t?.(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const d=["/respond-invite","/befriend","/r","/ai"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(k,Date.now().toString()),localStorage.setItem(N,d)}window.location.href=o.loginUrl}).catch(o=>{c("Something went wrong. Please try again later."),a(!1),t?.(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:n||g,onClick:f,children:[n?e.jsx(E,{className:"h-[18px] w-[18px]",isDualRing:!1}):e.jsx(G,{className:"h-[18px] w-[18px]"}),"Continue with Google"]}),m&&e.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:m})]})}function T(u){const{className:g}=u;return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:g,x:"0px",y:"0px",width:"100",height:"100",viewBox:"0,0,256,256",children:e.jsx("g",{transform:"translate(-26.66667,-26.66667) scale(1.20833,1.20833)",children:e.jsx("g",{fill:"none",fillRule:"nonzero",stroke:"none",strokeWidth:"1",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:"10",strokeDasharray:"",strokeDashoffset:"0",fontFamily:"none",fontWeight:"none",fontSize:"none",textAnchor:"none",style:{mixBlendMode:"normal"},children:e.jsxs("g",{transform:"scale(5.33333,5.33333)",children:[e.jsx("path",{d:"M42,37c0,2.762 -2.238,5 -5,5h-26c-2.761,0 -5,-2.238 -5,-5v-26c0,-2.762 2.239,-5 5,-5h26c2.762,0 5,2.238 5,5z",fill:"#0288d1"}),e.jsx("path",{d:"M12,19h5v17h-5zM14.485,17h-0.028c-1.492,0 -2.457,-1.112 -2.457,-2.501c0,-1.419 0.995,-2.499 2.514,-2.499c1.521,0 2.458,1.08 2.486,2.499c0,1.388 -0.965,2.501 -2.515,2.501zM36,36h-5v-9.099c0,-2.198 -1.225,-3.698 -3.192,-3.698c-1.501,0 -2.313,1.012 -2.707,1.99c-0.144,0.35 -0.101,1.318 -0.101,1.807v9h-5v-17h5v2.616c0.721,-1.116 1.85,-2.616 4.738,-2.616c3.578,0 6.261,2.25 6.261,7.274l0.001,9.726z",fill:"#ffffff"})]})})})})}const R="linkedInRedirectAt",P="linkedInLastPage";function _(u){const{isDisabled:g,setIsDisabled:t}=u,[n,a]=i.useState(!1),[m,c]=i.useState("");i.useEffect(()=>{const o=new URLSearchParams(window.location.search),l=o.get("code"),d=o.get("state"),p=o.get("provider");!l||!d||p!=="linkedin"||(a(!0),t?.(!0),I(`https://api.roadmap.sh/v1-linkedin-callback${window.location.search}`).then(({response:r,error:w})=>{if(!r?.token){c(w?.message||"Something went wrong."),a(!1),t?.(!1);return}let s="/";const x=localStorage.getItem(R),h=localStorage.getItem(P);if(x&&h){const S=parseInt(x,10);Date.now()-S<30*1e3&&(s=h)}const b=localStorage.getItem("authRedirect");b&&(localStorage.removeItem("authRedirect"),s=b),localStorage.removeItem(R),localStorage.removeItem(P),y(r.token),window.location.href=s}).catch(r=>{c("Something went wrong. Please try again later."),a(!1),t?.(!1)}))},[]);const f=()=>{a(!0),t?.(!0),I("https://api.roadmap.sh/v1-linkedin-login").then(({response:o,error:l})=>{if(!o?.loginUrl){c(l?.message||"Something went wrong."),a(!1),t?.(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const d=["/respond-invite","/befriend","/r","/ai"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(R,Date.now().toString()),localStorage.setItem(P,d)}window.location.href=o.loginUrl}).catch(o=>{c("Something went wrong. Please try again later."),a(!1),t?.(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:n||g,onClick:f,children:[n?e.jsx(E,{className:"h-[18px] w-[18px]",isDualRing:!1}):e.jsx(T,{className:"h-[18px] w-[18px]"}),"Continue with LinkedIn"]}),m&&e.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:m})]})}function $(u){const{isDisabled:g,setIsDisabled:t}=u,[n,a]=i.useState(""),[m,c]=i.useState(""),[f,o]=i.useState(""),[l,d]=i.useState(!1),p=async r=>{r.preventDefault(),d(!0),t?.(!0),o("");const{response:w,error:s}=await A("https://api.roadmap.sh/v1-login",{email:n,password:m});if(w?.token){y(w.token),window.location.reload();return}if(s.type==="user_not_verified"){window.location.href=`/verification-pending?email=${encodeURIComponent(n)}`;return}d(!1),t?.(!1),o(s?.message||"Something went wrong. Please try again later.")};return e.jsxs("form",{className:"w-full",onSubmit:p,children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e.jsx("input",{name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Email Address",value:n,onInput:r=>a(String(r.target.value))}),e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{name:"password",type:"password",autoComplete:"current-password",required:!0,className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Password",value:m,onInput:r=>c(String(r.target.value))}),e.jsx("p",{className:"mb-3 mt-2 text-sm text-gray-500",children:e.jsx("a",{href:"/forgot-password",className:"text-blue-800 hover:text-blue-600",children:"Reset your password?"})}),f&&e.jsx("p",{className:"mb-2 rounded-md bg-red-100 p-2 text-red-800",children:f}),e.jsx("button",{type:"submit",disabled:l||g,className:"inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:l?"Please wait...":"Continue"})]})}function B(u){const{isDisabled:g,setIsDisabled:t}=u,[n,a]=i.useState(""),[m,c]=i.useState(""),[f,o]=i.useState(""),[l,d]=i.useState(""),[p,r]=i.useState(!1),w=async s=>{s.preventDefault(),r(!0),t?.(!0),d("");const{response:x,error:h}=await A("https://api.roadmap.sh/v1-register",{email:n,password:m,name:f});if(h||x?.status!=="ok"){r(!1),t?.(!1),d(h?.message||"Something went wrong. Please try again later.");return}window.location.href=`/verification-pending?email=${encodeURIComponent(n)}`};return e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:w,children:[e.jsx("label",{htmlFor:"name",className:"sr-only",children:"Name"}),e.jsx("input",{name:"name",type:"text",autoComplete:"name",min:3,max:50,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Full Name",value:f,onInput:s=>o(String(s.target.value))}),e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e.jsx("input",{name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2  outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Email Address",value:n,onInput:s=>a(String(s.target.value))}),e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{name:"password",type:"password",autoComplete:"current-password",min:6,max:50,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Password",value:m,onInput:s=>c(String(s.target.value))}),l&&e.jsxs("p",{className:"rounded-lg bg-red-100 p-2 text-red-700",children:[l,"."]}),e.jsx("button",{type:"submit",disabled:p||g,className:"inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:p?"Please wait...":"Continue to Verify Email"})]})}function W(u){const{type:g="login"}=u,[t,n]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-col gap-2",children:[e.jsx(U,{isDisabled:t,setIsDisabled:n}),e.jsx(F,{isDisabled:t,setIsDisabled:n}),e.jsx(_,{isDisabled:t,setIsDisabled:n})]}),e.jsxs("div",{className:"flex w-full items-center gap-2 py-6 text-sm text-slate-600",children:[e.jsx("div",{className:"h-px w-full bg-slate-200"}),"OR",e.jsx("div",{className:"h-px w-full bg-slate-200"})]}),g==="login"?e.jsx($,{isDisabled:t,setIsDisabled:n}):e.jsx(B,{isDisabled:t,setIsDisabled:n})]})}export{W as AuthenticationForm};
